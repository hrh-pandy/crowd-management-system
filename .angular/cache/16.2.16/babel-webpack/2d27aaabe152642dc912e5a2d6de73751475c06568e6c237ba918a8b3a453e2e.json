{"ast":null,"code":"import { Chart } from 'chart.js/auto';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/dashboard.service\";\nimport * as i2 from \"../../core/services/analytics-context.service\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"occupancyChart\"];\nconst _c1 = [\"demographicsChart\"];\nconst _c2 = [\"demographicsLineChart\"];\nconst _c3 = [\"footfallChart\"];\nfunction DashboardComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵelement(1, \"div\", 21);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading dashboard...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(dashboardService, analyticsContext) {\n      this.dashboardService = dashboardService;\n      this.analyticsContext = analyticsContext;\n      /* ================= LOADING STATE ================= */\n      this.loading = false;\n      /* ================= KPIs ================= */\n      this.liveOccupancy = 0;\n      this.footfall = 0;\n      this.avgDwellTime = '';\n      /* ================= CHECK IF ALL DATA LOADED ================= */\n      this.loadCount = 0;\n    }\n    /* ================= INIT ================= */\n    ngOnInit() {\n      this.analyticsContext.context$.subscribe(() => {\n        this.loading = true;\n        this.loadKPIs();\n        this.loadOccupancyTimeline();\n        this.loadDemographics();\n        this.loadFootfallByHour();\n        // Ensure canvas is rendered before drawing\n        setTimeout(() => {\n          this.renderDemographicsLineChart();\n        });\n      });\n    }\n    ngOnDestroy() {\n      this.occupancyChart?.destroy();\n      this.demographicsChart?.destroy();\n      this.demographicsLineChart?.destroy();\n      this.footfallChart?.destroy();\n    }\n    /* ================= KPIs ================= */\n    loadKPIs() {\n      this.dashboardService.getFootfall().subscribe(res => {\n        this.footfall = res.footfall ?? 0;\n        this.checkAllLoaded();\n      });\n      this.dashboardService.getDwellTime().subscribe(res => {\n        const mins = Math.floor(res.avgDwellMinutes || 0);\n        const secs = Math.round(((res.avgDwellMinutes || 0) - mins) * 60);\n        this.avgDwellTime = `${mins} min ${secs} sec`;\n        this.checkAllLoaded();\n      });\n    }\n    /* ================= OCCUPANCY TIMELINE ================= */\n    loadOccupancyTimeline() {\n      this.dashboardService.getOccupancyTimeline().subscribe(res => {\n        if (!res?.buckets?.length) {\n          this.checkAllLoaded();\n          return;\n        }\n        const labels = [];\n        const values = [];\n        res.buckets.forEach(b => {\n          labels.push(b.local.split(' ')[1].slice(0, 5));\n          values.push(b.avg > 0 ? Math.round(b.avg) : null);\n        });\n        this.liveOccupancy = [...values].reverse().find(v => v !== null) ?? 0;\n        this.renderOccupancyChart(labels, values);\n        this.checkAllLoaded();\n      });\n    }\n    renderOccupancyChart(labels, values) {\n      this.occupancyChart?.destroy();\n      this.occupancyChart = new Chart(this.occupancyCanvas.nativeElement, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            data: values,\n            borderColor: '#0d9488',\n            borderWidth: 2,\n            fill: false,\n            tension: 0.35,\n            spanGaps: true,\n            pointRadius: 2\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              display: false\n            }\n          },\n          scales: {\n            x: {\n              grid: {\n                display: false\n              }\n            },\n            y: {\n              beginAtZero: false,\n              suggestedMin: 80,\n              suggestedMax: 150\n            }\n          }\n        }\n      });\n    }\n    /* ================= DEMOGRAPHICS DONUT ================= */\n    loadDemographics() {\n      this.dashboardService.getDemographics().subscribe(res => {\n        if (!res) {\n          this.checkAllLoaded();\n          return;\n        }\n        const values = Object.values(res);\n        this.demographicsChart?.destroy();\n        this.demographicsChart = new Chart(this.demographicsCanvas.nativeElement, {\n          type: 'doughnut',\n          data: {\n            labels: ['Male', 'Female'],\n            datasets: [{\n              data: values,\n              backgroundColor: ['#7fb6b2', '#bfe5e1'],\n              borderWidth: 6,\n              borderColor: '#ffffff'\n            }]\n          },\n          options: {\n            cutout: '75%',\n            responsive: true,\n            plugins: {\n              legend: {\n                display: false\n              }\n            }\n          }\n        });\n        this.checkAllLoaded();\n      });\n    }\n    /* ================= DEMOGRAPHICS ANALYSIS (LINE) ================= */\n    renderDemographicsLineChart() {\n      if (!this.demographicsLineCanvas) return;\n      this.demographicsLineChart?.destroy();\n      this.demographicsLineChart = new Chart(this.demographicsLineCanvas.nativeElement, {\n        type: 'line',\n        data: {\n          labels: ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'],\n          datasets: [{\n            label: 'Male',\n            data: [180, 182, 185, 188, 195, 198, 192, 200, 205, 202, 210],\n            borderColor: '#7fb6b2',\n            backgroundColor: 'rgba(127,182,178,0.12)',\n            tension: 0.4,\n            fill: true\n          }, {\n            label: 'Female',\n            data: [135, 138, 140, 142, 147, 149, 145, 150, 152, 150, 158],\n            borderColor: '#bfe5e1',\n            backgroundColor: 'rgba(191,229,225,0.18)',\n            tension: 0.4,\n            fill: true\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'top',\n              align: 'end'\n            }\n          },\n          scales: {\n            x: {\n              grid: {\n                color: '#eef2f3'\n              },\n              title: {\n                display: true,\n                text: 'Time'\n              }\n            },\n            y: {\n              beginAtZero: true,\n              grid: {\n                color: '#eef2f3'\n              },\n              title: {\n                display: true,\n                text: 'Count'\n              }\n            }\n          }\n        }\n      });\n    }\n    /* ================= FOOTFALL BY HOUR ================= */\n    loadFootfallByHour() {\n      this.dashboardService.getFootfall().subscribe(res => {\n        if (!res?.buckets?.length) {\n          this.checkAllLoaded();\n          return;\n        }\n        const labels = [];\n        const values = [];\n        res.buckets.forEach(b => {\n          labels.push(b.local.split(' ')[1].slice(0, 5));\n          values.push(b.count);\n        });\n        this.footfallChart?.destroy();\n        this.footfallChart = new Chart(this.footfallCanvas.nativeElement, {\n          type: 'bar',\n          data: {\n            labels,\n            datasets: [{\n              data: values,\n              backgroundColor: '#38bdf8',\n              borderRadius: 4\n            }]\n          },\n          options: {\n            responsive: true,\n            plugins: {\n              legend: {\n                display: false\n              }\n            },\n            scales: {\n              x: {\n                grid: {\n                  display: false\n                }\n              },\n              y: {\n                beginAtZero: true\n              }\n            }\n          }\n        });\n        this.checkAllLoaded();\n      });\n    }\n    checkAllLoaded() {\n      this.loadCount++;\n      // Wait for all 5 API calls to complete\n      if (this.loadCount >= 5) {\n        this.loading = false;\n        this.loadCount = 0;\n      }\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(t) {\n        return new (t || DashboardComponent)(i0.ɵɵdirectiveInject(i1.DashboardService), i0.ɵɵdirectiveInject(i2.AnalyticsContextService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        viewQuery: function DashboardComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n            i0.ɵɵviewQuery(_c1, 5);\n            i0.ɵɵviewQuery(_c2, 5);\n            i0.ɵɵviewQuery(_c3, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.occupancyCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.demographicsCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.demographicsLineCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.footfallCanvas = _t.first);\n          }\n        },\n        decls: 59,\n        vars: 4,\n        consts: [[\"class\", \"dashboard-loader\", 4, \"ngIf\"], [1, \"overview\"], [1, \"cards\"], [1, \"card\"], [1, \"chart-section\"], [1, \"chart-card\", \"fixed-height\"], [\"occupancyChart\", \"\"], [1, \"demographics-section\"], [1, \"demographics-grid\"], [1, \"demo-card\"], [1, \"donut-wrapper\"], [\"demographicsChart\", \"\"], [1, \"donut-center\"], [1, \"legend\"], [1, \"legend-item\"], [1, \"dot\", \"male\"], [1, \"dot\", \"female\"], [1, \"demo-card\", \"wide\"], [1, \"chart-container\"], [\"demographicsLineChart\", \"\"], [1, \"dashboard-loader\"], [1, \"spinner\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, DashboardComponent_div_0_Template, 4, 0, \"div\", 0);\n            i0.ɵɵelementStart(1, \"section\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"p\");\n            i0.ɵɵtext(5, \"Live Occupancy\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"h2\");\n            i0.ɵɵtext(7);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(8, \"div\", 3)(9, \"p\");\n            i0.ɵɵtext(10, \"Today's Footfall\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"h2\");\n            i0.ɵɵtext(12);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"div\", 3)(14, \"p\");\n            i0.ɵɵtext(15, \"Avg Dwell Time\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"h2\");\n            i0.ɵɵtext(17);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(18, \"section\", 4)(19, \"h3\");\n            i0.ɵɵtext(20, \"Occupancy Timeline\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"div\", 5);\n            i0.ɵɵelement(22, \"canvas\", null, 6);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(24, \"section\", 7)(25, \"section\", 7)(26, \"h3\");\n            i0.ɵɵtext(27, \"Demographics\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"div\", 8)(29, \"div\", 9)(30, \"h4\");\n            i0.ɵɵtext(31, \"Chart of Demographics\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(32, \"div\", 10);\n            i0.ɵɵelement(33, \"canvas\", null, 11);\n            i0.ɵɵelementStart(35, \"div\", 12)(36, \"p\");\n            i0.ɵɵtext(37, \"Total Crowd\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(38, \"h2\");\n            i0.ɵɵtext(39, \"100%\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(40, \"div\", 13)(41, \"div\", 14);\n            i0.ɵɵelement(42, \"span\", 15);\n            i0.ɵɵelementStart(43, \"span\")(44, \"strong\");\n            i0.ɵɵtext(45, \"55%\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(46, \" Males\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(47, \"div\", 14);\n            i0.ɵɵelement(48, \"span\", 16);\n            i0.ɵɵelementStart(49, \"span\")(50, \"strong\");\n            i0.ɵɵtext(51, \"45%\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(52, \" Females\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(53, \"div\", 17)(54, \"h4\");\n            i0.ɵɵtext(55, \"Demographics Analysis\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(56, \"div\", 18);\n            i0.ɵɵelement(57, \"canvas\", null, 19);\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate(ctx.liveOccupancy);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.footfall);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.avgDwellTime);\n          }\n        },\n        dependencies: [i3.NgIf],\n        styles: [\".dashboard-loader[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(255,255,255,.95);display:flex;flex-direction:column;justify-content:center;align-items:center;gap:16px;z-index:9999}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f4f6;border-top:4px solid #0d9488;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.dashboard-loader[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.dashboard-layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f5f7f9}.sidebar[_ngcontent-%COMP%]{width:220px;background:#111827;color:#fff;padding:20px}.sidebar[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-bottom:30px}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;margin-bottom:14px;color:#9ca3af;cursor:pointer}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#fff}.main[_ngcontent-%COMP%]{flex:1;padding:24px 32px}.topbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.card[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:14px}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:12px 0}.up[_ngcontent-%COMP%]{color:#16a34a}.down[_ngcontent-%COMP%]{color:#dc2626}.chart-section[_ngcontent-%COMP%]{margin-top:32px}.chart-card[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:14px}.fixed-height[_ngcontent-%COMP%]{height:280px}.demo-card[_ngcontent-%COMP%]{background:#fff;border-radius:14px;padding:20px}.donut-wrapper[_ngcontent-%COMP%]{position:relative;width:240px;height:240px;margin:24px auto}.legend[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px}canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important}.demographics-section[_ngcontent-%COMP%]{margin-top:40px}.demographics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;gap:24px}.demo-card[_ngcontent-%COMP%]{background:#ffffff;border-radius:14px;padding:20px;box-shadow:0 4px 20px #0000000a}.demo-card.wide[_ngcontent-%COMP%]{padding:24px}.donut-wrapper[_ngcontent-%COMP%]{position:relative;width:260px;height:260px;margin:24px auto}.donut-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important}.donut-center[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}.donut-center[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:#6b7280}.donut-center[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:28px;margin:0}.legend[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:28px;margin-top:12px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.dot[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%}.dot.male[_ngcontent-%COMP%]{background:#7fb6b2}.dot.female[_ngcontent-%COMP%]{background:#bfe5e1}.chart-container[_ngcontent-%COMP%]{height:260px}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}