{"ast":null,"code":"import { Chart } from 'chart.js/auto';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/dashboard.service\";\nimport * as i2 from \"../../core/services/analytics-context.service\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"occupancyChart\"];\nconst _c1 = [\"demographicsChart\"];\nconst _c2 = [\"demographicsLineChart\"];\nconst _c3 = [\"footfallChart\"];\nfunction DashboardComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"div\", 16);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2, \"Live Occupancy\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r1.liveOccupancy);\n  }\n}\nfunction DashboardComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"div\", 16);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2, \"Today's Footfall\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r3.footfall);\n  }\n}\nfunction DashboardComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"div\", 16);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2, \"Avg Dwell Time\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r5.avgDwellTime);\n  }\n}\nfunction DashboardComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵelement(1, \"div\", 18);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading occupancy data...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_canvas_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"canvas\", null, 19);\n  }\n}\nfunction DashboardComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵelement(1, \"div\", 18);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading demographics...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 21);\n    i0.ɵɵelement(2, \"canvas\", null, 22);\n    i0.ɵɵelementStart(4, \"div\", 23)(5, \"p\");\n    i0.ɵɵtext(6, \"Total Crowd\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"h2\");\n    i0.ɵɵtext(8, \"100%\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"div\", 24)(10, \"div\", 25);\n    i0.ɵɵelement(11, \"span\", 26);\n    i0.ɵɵelementStart(12, \"span\")(13, \"strong\");\n    i0.ɵɵtext(14, \"55%\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15, \" Males\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 25);\n    i0.ɵɵelement(17, \"span\", 27);\n    i0.ɵɵelementStart(18, \"span\")(19, \"strong\");\n    i0.ɵɵtext(20, \"45%\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(21, \" Females\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nfunction DashboardComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵelement(1, \"div\", 18);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading analysis...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵelement(1, \"canvas\", null, 30);\n    i0.ɵɵelementEnd();\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(dashboardService, analyticsContext) {\n      this.dashboardService = dashboardService;\n      this.analyticsContext = analyticsContext;\n      /* ================= LOADING STATES ================= */\n      this.loadingKPIs = false;\n      this.loadingOccupancy = false;\n      this.loadingDemographics = false;\n      this.loadingFootfall = false;\n      /* ================= KPIs ================= */\n      this.liveOccupancy = 0;\n      this.footfall = 0;\n      this.avgDwellTime = '';\n    }\n    /* ================= INIT ================= */\n    ngOnInit() {\n      this.analyticsContext.context$.subscribe(() => {\n        this.loadKPIs();\n        this.loadOccupancyTimeline();\n        this.loadDemographics();\n        this.loadFootfallByHour();\n        // Ensure canvas is rendered before drawing\n        setTimeout(() => {\n          this.renderDemographicsLineChart();\n        });\n      });\n    }\n    ngOnDestroy() {\n      this.occupancyChart?.destroy();\n      this.demographicsChart?.destroy();\n      this.demographicsLineChart?.destroy();\n      this.footfallChart?.destroy();\n    }\n    /* ================= KPIs ================= */\n    loadKPIs() {\n      this.loadingKPIs = true;\n      // Footfall\n      this.dashboardService.getFootfall().subscribe({\n        next: res => {\n          this.footfall = res.footfall ?? 0;\n        },\n        error: err => {\n          console.error('Error loading footfall:', err);\n          this.loadingKPIs = false;\n        }\n      });\n      // Dwell Time\n      this.dashboardService.getDwellTime().subscribe({\n        next: res => {\n          const mins = Math.floor(res.avgDwellMinutes || 0);\n          const secs = Math.round(((res.avgDwellMinutes || 0) - mins) * 60);\n          this.avgDwellTime = `${mins} min ${secs} sec`;\n          this.loadingKPIs = false;\n        },\n        error: err => {\n          console.error('Error loading dwell time:', err);\n          this.loadingKPIs = false;\n        }\n      });\n    }\n    /* ================= OCCUPANCY TIMELINE ================= */\n    loadOccupancyTimeline() {\n      this.loadingOccupancy = true;\n      this.dashboardService.getOccupancyTimeline().subscribe({\n        next: res => {\n          if (!res?.buckets?.length) {\n            this.loadingOccupancy = false;\n            return;\n          }\n          const labels = [];\n          const values = [];\n          res.buckets.forEach(b => {\n            labels.push(b.local.split(' ')[1].slice(0, 5));\n            values.push(b.avg > 0 ? Math.round(b.avg) : null);\n          });\n          this.liveOccupancy = [...values].reverse().find(v => v !== null) ?? 0;\n          this.renderOccupancyChart(labels, values);\n          this.loadingOccupancy = false;\n        },\n        error: err => {\n          console.error('Error loading occupancy:', err);\n          this.loadingOccupancy = false;\n        }\n      });\n    }\n    renderOccupancyChart(labels, values) {\n      this.occupancyChart?.destroy();\n      this.occupancyChart = new Chart(this.occupancyCanvas.nativeElement, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            data: values,\n            borderColor: '#0d9488',\n            borderWidth: 2,\n            fill: false,\n            tension: 0.35,\n            spanGaps: true,\n            pointRadius: 2\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              display: false\n            }\n          },\n          scales: {\n            x: {\n              grid: {\n                display: false\n              }\n            },\n            y: {\n              beginAtZero: false,\n              suggestedMin: 80,\n              suggestedMax: 150\n            }\n          }\n        }\n      });\n    }\n    /* ================= DEMOGRAPHICS DONUT ================= */\n    loadDemographics() {\n      this.loadingDemographics = true;\n      this.dashboardService.getDemographics().subscribe({\n        next: res => {\n          if (!res) {\n            this.loadingDemographics = false;\n            return;\n          }\n          const values = Object.values(res);\n          this.demographicsChart?.destroy();\n          this.demographicsChart = new Chart(this.demographicsCanvas.nativeElement, {\n            type: 'doughnut',\n            data: {\n              labels: ['Male', 'Female'],\n              datasets: [{\n                data: values,\n                backgroundColor: ['#7fb6b2', '#bfe5e1'],\n                borderWidth: 6,\n                borderColor: '#ffffff'\n              }]\n            },\n            options: {\n              cutout: '75%',\n              responsive: true,\n              plugins: {\n                legend: {\n                  display: false\n                }\n              }\n            }\n          });\n          this.loadingDemographics = false;\n        },\n        error: err => {\n          console.error('Error loading demographics:', err);\n          this.loadingDemographics = false;\n        }\n      });\n    }\n    /* ================= DEMOGRAPHICS ANALYSIS (LINE) ================= */\n    renderDemographicsLineChart() {\n      if (!this.demographicsLineCanvas) return;\n      this.demographicsLineChart?.destroy();\n      this.demographicsLineChart = new Chart(this.demographicsLineCanvas.nativeElement, {\n        type: 'line',\n        data: {\n          labels: ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'],\n          datasets: [{\n            label: 'Male',\n            data: [180, 182, 185, 188, 195, 198, 192, 200, 205, 202, 210],\n            borderColor: '#7fb6b2',\n            backgroundColor: 'rgba(127,182,178,0.12)',\n            tension: 0.4,\n            fill: true\n          }, {\n            label: 'Female',\n            data: [135, 138, 140, 142, 147, 149, 145, 150, 152, 150, 158],\n            borderColor: '#bfe5e1',\n            backgroundColor: 'rgba(191,229,225,0.18)',\n            tension: 0.4,\n            fill: true\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'top',\n              align: 'end'\n            }\n          },\n          scales: {\n            x: {\n              grid: {\n                color: '#eef2f3'\n              },\n              title: {\n                display: true,\n                text: 'Time'\n              }\n            },\n            y: {\n              beginAtZero: true,\n              grid: {\n                color: '#eef2f3'\n              },\n              title: {\n                display: true,\n                text: 'Count'\n              }\n            }\n          }\n        }\n      });\n    }\n    /* ================= FOOTFALL BY HOUR ================= */\n    loadFootfallByHour() {\n      this.loadingFootfall = true;\n      this.dashboardService.getFootfall().subscribe({\n        next: res => {\n          if (!res?.buckets?.length) {\n            this.loadingFootfall = false;\n            return;\n          }\n          const labels = [];\n          const values = [];\n          res.buckets.forEach(b => {\n            labels.push(b.local.split(' ')[1].slice(0, 5));\n            values.push(b.count);\n          });\n          this.footfallChart?.destroy();\n          this.footfallChart = new Chart(this.footfallCanvas.nativeElement, {\n            type: 'bar',\n            data: {\n              labels,\n              datasets: [{\n                data: values,\n                backgroundColor: '#38bdf8',\n                borderRadius: 4\n              }]\n            },\n            options: {\n              responsive: true,\n              plugins: {\n                legend: {\n                  display: false\n                }\n              },\n              scales: {\n                x: {\n                  grid: {\n                    display: false\n                  }\n                },\n                y: {\n                  beginAtZero: true\n                }\n              }\n            }\n          });\n          this.loadingFootfall = false;\n        },\n        error: err => {\n          console.error('Error loading footfall:', err);\n          this.loadingFootfall = false;\n        }\n      });\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(t) {\n        return new (t || DashboardComponent)(i0.ɵɵdirectiveInject(i1.DashboardService), i0.ɵɵdirectiveInject(i2.AnalyticsContextService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        viewQuery: function DashboardComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n            i0.ɵɵviewQuery(_c1, 5);\n            i0.ɵɵviewQuery(_c2, 5);\n            i0.ɵɵviewQuery(_c3, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.occupancyCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.demographicsCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.demographicsLineCanvas = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.footfallCanvas = _t.first);\n          }\n        },\n        decls: 31,\n        vars: 12,\n        consts: [[1, \"overview\"], [1, \"cards\"], [1, \"card\"], [\"class\", \"card-loader\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"chart-section\"], [1, \"chart-card\", \"fixed-height\"], [\"class\", \"chart-loader\", 4, \"ngIf\"], [1, \"demographics-section\"], [1, \"demographics-grid\"], [1, \"demo-card\"], [\"class\", \"chart-loader\", \"style\", \"min-height: 350px;\", 4, \"ngIf\"], [1, \"demo-card\", \"wide\"], [\"class\", \"chart-loader\", \"style\", \"min-height: 300px;\", 4, \"ngIf\"], [\"class\", \"chart-container\", 4, \"ngIf\"], [1, \"card-loader\"], [1, \"spinner-small\"], [1, \"chart-loader\"], [1, \"spinner\"], [\"occupancyChart\", \"\"], [1, \"chart-loader\", 2, \"min-height\", \"350px\"], [1, \"donut-wrapper\"], [\"demographicsChart\", \"\"], [1, \"donut-center\"], [1, \"legend\"], [1, \"legend-item\"], [1, \"dot\", \"male\"], [1, \"dot\", \"female\"], [1, \"chart-loader\", 2, \"min-height\", \"300px\"], [1, \"chart-container\"], [\"demographicsLineChart\", \"\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2);\n            i0.ɵɵtemplate(3, DashboardComponent_div_3_Template, 2, 0, \"div\", 3);\n            i0.ɵɵtemplate(4, DashboardComponent_div_4_Template, 5, 1, \"div\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"div\", 2);\n            i0.ɵɵtemplate(6, DashboardComponent_div_6_Template, 2, 0, \"div\", 3);\n            i0.ɵɵtemplate(7, DashboardComponent_div_7_Template, 5, 1, \"div\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"div\", 2);\n            i0.ɵɵtemplate(9, DashboardComponent_div_9_Template, 2, 0, \"div\", 3);\n            i0.ɵɵtemplate(10, DashboardComponent_div_10_Template, 5, 1, \"div\", 4);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(11, \"section\", 5)(12, \"h3\");\n            i0.ɵɵtext(13, \"Occupancy Timeline\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(14, \"div\", 6);\n            i0.ɵɵtemplate(15, DashboardComponent_div_15_Template, 4, 0, \"div\", 7);\n            i0.ɵɵtemplate(16, DashboardComponent_canvas_16_Template, 2, 0, \"canvas\", 4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"section\", 8)(18, \"h3\");\n            i0.ɵɵtext(19, \"Demographics\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"div\", 9)(21, \"div\", 10)(22, \"h4\");\n            i0.ɵɵtext(23, \"Chart of Demographics\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(24, DashboardComponent_div_24_Template, 4, 0, \"div\", 11);\n            i0.ɵɵtemplate(25, DashboardComponent_div_25_Template, 22, 0, \"div\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"div\", 12)(27, \"h4\");\n            i0.ɵɵtext(28, \"Demographics Analysis\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(29, DashboardComponent_div_29_Template, 4, 0, \"div\", 13);\n            i0.ɵɵtemplate(30, DashboardComponent_div_30_Template, 3, 0, \"div\", 14);\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingKPIs);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingKPIs);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingKPIs);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingKPIs);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingKPIs);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingKPIs);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingOccupancy);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingOccupancy);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingDemographics);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingDemographics);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", ctx.loadingDemographics);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loadingDemographics);\n          }\n        },\n        dependencies: [i3.NgIf],\n        styles: [\".card-loader[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100px}.spinner-small[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid #f3f4f6;border-top:3px solid #0d9488;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.chart-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:280px;gap:16px}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f4f6;border-top:4px solid #0d9488;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.chart-loader[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.card[_ngcontent-%COMP%]{position:relative;min-height:120px}.chart-card[_ngcontent-%COMP%]{position:relative}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}