{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./entry-exit.service\";\nimport * as i2 from \"../../core/services/analytics-context.service\";\nimport * as i3 from \"@angular/common\";\nfunction CrowdEntriesComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelement(1, \"div\", 4);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Loading entries...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CrowdEntriesComponent_div_2_tr_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const e_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(e_r5.personName || \"-\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(e_r5.gender || \"-\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(e_r5.entryLocal || \"--\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(e_r5.exitLocal || \"--\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(e_r5.dwellMinutes || \"--\");\n  }\n}\nfunction CrowdEntriesComponent_div_2_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 7);\n    i0.ɵɵtext(2, \"No records found\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CrowdEntriesComponent_div_2_div_17_button_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function CrowdEntriesComponent_div_2_div_17_button_3_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r10);\n      const i_r8 = restoredCtx.index;\n      const ctx_r9 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r9.goToPage(i_r8 + 1));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r8 = ctx.index;\n    const ctx_r6 = i0.ɵɵnextContext(3);\n    i0.ɵɵclassProp(\"active\", ctx_r6.page === i_r8 + 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i_r8 + 1, \" \");\n  }\n}\nconst _c0 = function () {\n  return [];\n};\nfunction CrowdEntriesComponent_div_2_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function CrowdEntriesComponent_div_2_div_17_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.prevPage());\n    });\n    i0.ɵɵtext(2, \"\\u2039\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, CrowdEntriesComponent_div_2_div_17_button_3_Template, 2, 3, \"button\", 10);\n    i0.ɵɵelementStart(4, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function CrowdEntriesComponent_div_2_div_17_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.nextPage());\n    });\n    i0.ɵɵtext(5, \"\\u203A\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.page <= 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(3, _c0).constructor(ctx_r4.totalPages));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.page >= ctx_r4.totalPages);\n  }\n}\nfunction CrowdEntriesComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Gender\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Entry\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Exit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Dwell Time\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, CrowdEntriesComponent_div_2_tr_15_Template, 11, 5, \"tr\", 5);\n    i0.ɵɵtemplate(16, CrowdEntriesComponent_div_2_tr_16_Template, 3, 0, \"tr\", 2);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(17, CrowdEntriesComponent_div_2_div_17_Template, 6, 4, \"div\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.entries);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.entries.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.totalPages > 0);\n  }\n}\nexport let CrowdEntriesComponent = /*#__PURE__*/(() => {\n  class CrowdEntriesComponent {\n    constructor(entryExitService, analyticsContext, cdr) {\n      this.entryExitService = entryExitService;\n      this.analyticsContext = analyticsContext;\n      this.cdr = cdr;\n      this.entries = [];\n      this.page = 1;\n      this.limit = 10;\n      this.total = 0;\n      this.totalPages = 0;\n      this.loading = false;\n    }\n    ngOnInit() {\n      console.log('CrowdEntries ngOnInit');\n      this.analyticsContext.context$.subscribe(() => {\n        console.log('Context changed, loading entries');\n        this.page = 1;\n        this.loadEntries();\n      });\n    }\n    loadEntries() {\n      this.loading = true;\n      this.entryExitService.getEntryExit(this.page, this.limit).subscribe({\n        next: res => {\n          console.log('API Response:', res);\n          // Extract entries\n          let data = [];\n          if (res.data && Array.isArray(res.data)) {\n            data = res.data;\n          } else if (res.data && res.data.entries && Array.isArray(res.data.entries)) {\n            data = res.data.entries;\n          } else if (res.entries && Array.isArray(res.entries)) {\n            data = res.entries;\n          } else if (res.records && Array.isArray(res.records)) {\n            data = res.records;\n          } else if (Array.isArray(res)) {\n            data = res;\n          }\n          this.entries = [...data];\n          console.log('Entries set:', this.entries);\n          // Calculate pagination\n          this.total = res.totalRecords || res.total || res.data && res.data.total || 0;\n          this.totalPages = res.totalPages || Math.ceil(this.total / this.limit);\n          console.log('Page:', this.page, 'Total:', this.total, 'TotalPages:', this.totalPages);\n          this.loading = false;\n          this.cdr.detectChanges();\n        },\n        error: err => {\n          console.error('API Error:', err);\n          this.loading = false;\n          this.cdr.detectChanges();\n        }\n      });\n    }\n    // Fixed pagination methods\n    prevPage() {\n      console.log('prevPage clicked, current page:', this.page);\n      if (this.page > 1 && !this.loading) {\n        this.page--;\n        console.log('Going to page:', this.page);\n        this.loadEntries();\n      }\n    }\n    nextPage() {\n      console.log('nextPage clicked, current page:', this.page, 'totalPages:', this.totalPages);\n      if (this.page < this.totalPages && !this.loading) {\n        this.page++;\n        console.log('Going to page:', this.page);\n        this.loadEntries();\n      }\n    }\n    // Direct page change\n    goToPage(pageNumber) {\n      console.log('goToPage called with:', pageNumber);\n      if (pageNumber >= 1 && pageNumber <= this.totalPages && !this.loading) {\n        this.page = pageNumber;\n        this.loadEntries();\n      }\n    }\n    static {\n      this.ɵfac = function CrowdEntriesComponent_Factory(t) {\n        return new (t || CrowdEntriesComponent)(i0.ɵɵdirectiveInject(i1.EntryExitService), i0.ɵɵdirectiveInject(i2.AnalyticsContextService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CrowdEntriesComponent,\n        selectors: [[\"app-crowd-entries\"]],\n        decls: 3,\n        vars: 2,\n        consts: [[1, \"table-card\"], [\"class\", \"loader-container\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"loader-container\"], [1, \"spinner\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"pagination\", 4, \"ngIf\"], [\"colspan\", \"5\", 1, \"empty\"], [1, \"pagination\"], [\"type\", \"button\", 3, \"disabled\", \"click\"], [\"type\", \"button\", 3, \"active\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 3, \"click\"]],\n        template: function CrowdEntriesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0);\n            i0.ɵɵtemplate(1, CrowdEntriesComponent_div_1_Template, 4, 0, \"div\", 1);\n            i0.ɵɵtemplate(2, CrowdEntriesComponent_div_2_Template, 18, 3, \"div\", 2);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf],\n        styles: [\".entries-layout[_ngcontent-%COMP%]{padding:24px}.table-card[_ngcontent-%COMP%]{background:#fff;border-radius:14px;padding:20px;min-height:400px;position:relative}.loader-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:400px;gap:16px}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid #f3f4f6;border-top:4px solid #0d9488;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loader-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{background:#f3f4f6}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:14px;text-align:left;font-size:14px;border-bottom:1px solid #eee}th[_ngcontent-%COMP%]{font-weight:600}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child{border-bottom:none}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.empty[_ngcontent-%COMP%]{text-align:center;color:#777;padding:40px;font-style:italic}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:20px}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:#0d9488;color:#fff;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:18px;transition:background .2s}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background:#0f766e}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed;opacity:.6}.pagination[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;color:#374151;font-weight:500;min-width:100px;text-align:center}\"]\n      });\n    }\n  }\n  return CrowdEntriesComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}